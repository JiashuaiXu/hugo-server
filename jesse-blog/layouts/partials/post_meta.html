{{- $scratch := newScratch }}

{{- /* Determine if this is being called from a list item */ -}}
{{- $ctx := . -}}
{{- $isListItem := false -}}
{{- if reflect.IsMap . -}}
  {{- $ctx = .page -}}
  {{- $isListItem = .isListItem | default false -}}
{{- end -}}

{{- /* åœ¨åˆ—è¡¨é¡µï¼ˆä¸»é¡µï¼‰æ˜¾ç¤ºæ ‡ç­¾ä¸ºä¸»è¦å†…å®¹ï¼Œç®€æ´å…ƒä¿¡æ¯ */ -}}
{{- if $isListItem -}}
  {{- $metaItems := slice -}}
  
  {{- /* ä¼˜å…ˆæ˜¾ç¤ºæ ‡ç­¾ */ -}}
  {{- with $ctx.Params.tags -}}
    {{- /* è·å–å‰3ä¸ªæ ‡ç­¾ï¼Œé¿å…æ˜¾ç¤ºå¤ªå¤š */ -}}
    {{- $tags := first 3 . -}}
    {{- $tagStr := delimit $tags ", " -}}
    {{- $metaItems = $metaItems | append (printf "<span class='post-tags'>ğŸ·ï¸ %s</span>" $tagStr) }}
  {{- end -}}
  
  {{- /* åªæ˜¾ç¤ºæ—¥æœŸä½œä¸ºåŸºæœ¬å…ƒä¿¡æ¯ */ -}}
  {{- if not $ctx.Date.IsZero -}}
    {{- $metaItems = $metaItems | append (printf "<span class='post-date' title='%s'>%s</span>" ($ctx.Date) ($ctx.Date | time.Format (default "2006-01-02" site.Params.DateFormat))) }}
  {{- end -}}

  {{- $scratch.Set "meta" $metaItems -}}

{{- /* åœ¨å•é¡µæ˜¾ç¤ºè¯¦ç»†å…ƒä¿¡æ¯ï¼ˆå«emojiï¼‰ */ -}}
{{- else -}}
  {{- $metaItems := slice -}}
  {{- if not $ctx.Date.IsZero -}}
    {{- $metaItems = $metaItems | append (printf "<span title='%s'>ğŸ“… %s</span>" ($ctx.Date) ($ctx.Date | time.Format (default "2006-01-02" site.Params.DateFormat))) }}
  {{- end }}

  {{- if ($ctx.Param "ShowReadingTime") -}}
    {{- $metaItems = $metaItems | append (printf "<span>â±ï¸ %d min read</span>" $ctx.ReadingTime) }}
  {{- end }}

  {{- if ($ctx.Param "ShowWordCount") -}}
    {{- $metaItems = $metaItems | append (printf "<span>ğŸ“ %d words</span>" $ctx.WordCount) }}
  {{- end }}

  {{- if not ($ctx.Param "hideAuthor") -}}
    {{- with (partial "author.html" $ctx) }}
      {{- $metaItems = $metaItems | append (printf "<span>âœï¸ %s</span>" .) }}
    {{- end }}
  {{- end }}
  
  {{- $scratch.Set "meta" $metaItems -}}
{{- end -}}

{{- with ($scratch.Get "meta") }}
{{- delimit . "&nbsp;Â·&nbsp;" | safeHTML -}}
{{- end -}}

<!-- å•ç¯‡æ–‡ç« é˜…è¯»æ•° - ä»…åœ¨è¯¦æƒ…é¡µæ˜¾ç¤º -->
{{- if not $isListItem -}}
<span id="busuanzi_container_page_pv" class="post-views">
  &nbsp;Â·&nbsp;ğŸ‘ï¸ <span id="busuanzi_value_page_pv"></span> views
</span>
{{- else -}}
<span id="busuanzi_container_page_pv" class="post-views">
  &nbsp;Â·&nbsp;<span id="busuanzi_value_page_pv"></span> views
</span>
{{- end -}}
